# Part 2: 원본 이미지와 마스크 결합 기반 분류 작업

## **1. 개요**
본 파트에서는 **원본 이미지와 해당 마스크를 결합**하여 새로운 이미지를 생성한 뒤, 이를 기반으로 **분류 작업**을 수행합니다. 
이 작업은 마스크 정보가 원본 이미지의 분류 성능에 어떤 영향을 미치는지 평가하는 것을 목표로 합니다.

---

## **2. 진행 작업**
### **(1) 원본 이미지와 마스크 결합**
- 원본 이미지와 마스크 이미지를 결합하여 새로운 이미지를 생성.
- 마스크는 원본 이미지와 동일한 크기로 조정 후, 색상 채널을 확장하여 결합.

### **(2) 데이터 전처리 및 증강**
- 결합된 이미지를 **전처리 및 증강** 작업을 수행.
- Tensor 형태로 변환 후 저장하여 학습 과정에서 활용.

### **(3) 분류 모델 학습**
- EfficientNet-B1와 ViT(Vision Transformer)를 사용하여 분류 작업 수행.
- 모델 학습 및 검증 후, **Test Accuracy, Precision, Recall, F1 Score** 등의 평가 지표를 기록.

---

## **3. 코드 구성**
본 폴더에는 다음과 같은 4가지 코드가 포함됩니다:
1. **원본 이미지와 마스크 결합 코드**:
   - 원본 이미지와 마스크를 결합하여 새로운 이미지를 생성하는 코드.
2. **데이터 전처리 및 증강 코드**:
   - 결합된 이미지를 전처리하고 Tensor 형태로 저장.
3. **ViT 모델 학습 코드**:
   - Vision Transformer 기반 모델을 학습하고 평가.
4. **EfficientNet-B1 모델 학습 코드**:
   - EfficientNet-B1 기반 모델을 학습하고 평가.

---

## **4. 모델 성능 비교**

### **EfficientNet-B1**
- **Test Accuracy**: 79.56%
- **정밀도 (Precision), 재현율 (Recall), F1 Score**:

| Class  | Precision | Recall | F1 Score | Support |
|--------|-----------|--------|----------|---------|
| bkl    | 0.60      | 0.61   | 0.60     | 107     |
| nv     | 0.86      | 0.95   | 0.91     | 655     |
| df     | 0.60      | 0.25   | 0.35     | 12      |
| mel    | 0.82      | 0.34   | 0.48     | 135     |
| vasc   | 0.57      | 0.75   | 0.65     | 16      |
| bcc    | 0.57      | 0.78   | 0.66     | 49      |
| akiec  | 0.42      | 0.34   | 0.38     | 29      |

### **ViT**
- **Test Accuracy**: 68.49%
- **정밀도 (Precision), 재현율 (Recall), F1 Score**:

| Class  | Precision | Recall | F1 Score | Support |
|--------|-----------|--------|----------|---------|
| bkl    | 0.41      | 0.30   | 0.34     | 107     |
| nv     | 0.75      | 0.93   | 0.83     | 655     |
| df     | 0.00      | 0.00   | 0.00     | 12      |
| mel    | 0.38      | 0.28   | 0.32     | 135     |
| vasc   | 0.00      | 0.00   | 0.00     | 16      |
| bcc    | 0.78      | 0.14   | 0.24     | 49      |
| akiec  | 0.00      | 0.00   | 0.00     | 29      |

---

## **5. 비교 및 관찰**
### **EfficientNet-B1 vs. ViT**
- **EfficientNet-B0**:
  - 전체적인 정확도(79.56%)와 F1 Score에서 **ViT**를 상회.
  - 주요 클래스(nv)에서 강점을 보임.
  - 소수 클래스(df, mel 등)에서도 상대적으로 높은 성능.
- **ViT**:
  - 정확도(68.49%) 및 소수 클래스(df, vasc 등)에서 성능 저조.
  - 데이터 불균형 문제에 취약.

---

## **6. 결론**
- **EfficientNet-B0**:
  - 결합된 마스크 정보 활용 시에도 효율적이며, 전반적인 성능이 우수.
- **ViT**:
  - 모델 튜닝과 데이터 증강을 통해 성능 개선 가능성이 있음.
- **향후 작업 방향**:
  - 데이터 불균형 해소를 위한 증강 기법 활용.
  - 소수 클래스에 대한 학습 보완을 위해 Focal Loss 등 손실 함수 변경 고려.
 

### **마스크 결합 데이터를 사용한 결과 분석**

마스크 정보를 결합하여 분류 모델을 학습했을 때, 원본 이미지만 사용했을 때보다 성능이 낮아지는 결과가 나타났습니다. 이를 분석한 결과, 다음과 같은 요인이 성능 저하의 원인으로 지목될 수 있었습니다:

1. **마스크 정보의 제한적인 역할**  
   마스크는 병변의 위치 정보를 제공하지만, 질환 분류에 필요한 중요한 시각적 특징(예: 색상, 질감, 경계 등)을 포함하지 않아, 분류 모델 학습에 충분한 도움을 주지 못했을 가능성이 있습니다.

2. **모델의 마스크 활용 능력 부족**  
   사용된 EfficientNet과 ViT 모델은 원본 이미지 학습에 최적화되어 있어, 추가된 마스크 정보를 효과적으로 활용하지 못했을 가능성이 있습니다.

3. **데이터 복잡성 증가**  
   마스크 채널이 추가되면서 데이터의 구조적 복잡성이 증가해, 모델이 이를 학습하는 데 어려움을 겪었을 가능성이 있습니다. 특히, 마스크 정보가 일부 클래스에서 오히려 잡음으로 작용했을 수 있습니다.

4. **소수 클래스 문제**  
   데이터셋 내에서 소수 클래스에 대한 마스크 정보가 충분하지 않아, 모델이 해당 클래스에 대한 분류 성능을 개선하지 못했을 가능성이 있습니다. 이로 인해, 특히 ViT 모델에서 소수 클래스 성능이 더 크게 저하되었습니다.

5. **증강 기법 부족**  
   마스크 결합 데이터를 활용할 때, 마스크와 원본 이미지의 일관성을 유지하면서 증강하는 추가적인 데이터 증강 기법이 적용되지 않아, 모델의 학습이 충분히 이루어지지 않았을 가능성이 있습니다.

---

### **개선 방향**
이 결과를 바탕으로 다음과 같은 개선 사항을 고려할 수 있습니다:
1. **모델 아키텍처 개선**  
   마스크와 원본 이미지를 병렬적으로 처리하는 멀티-브랜치 네트워크를 설계하여, 마스크 정보를 효과적으로 활용할 수 있도록 개선합니다.

2. **소수 클래스 문제 해결**  
   Focal Loss를 적용하거나 소수 클래스에 대한 데이터를 오버샘플링하여 데이터 불균형 문제를 완화합니다.

3. **증강 기법 강화**  
   마스크와 원본 이미지의 일관성을 유지하면서 증강하는 기술(예: 채널 혼합 증강)을 도입해, 데이터 다양성을 높이고 모델 학습을 강화합니다.

---

### **결론**
마스크 결합 데이터의 활용은 피부 병변 위치 정보를 포함해 모델의 성능을 개선할 가능성이 있었으나, 데이터의 특성과 모델 설계의 불일치로 인해 오히려 성능 저하가 발생했습니다. 이러한 결과는 추가적인 데이터 증강, 모델 아키텍처 개선, 소수 클래스 문제 해결과 같은 전략이 필요함을 시사합니다.

> 본 분석을 바탕으로, 마스크 결합 데이터와 원본 이미지를 분리하여 각각의 특성을 살릴 수 있는 모델 설계와 학습 프로세스를 재검토할 필요가 있습니다.


